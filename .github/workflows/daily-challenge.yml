name: Daily GeoGuessr Challenge

on:
  # Schedule is via external cron (cron-job.org) at 9:20 and 12:20 CET â€“ see EXTERNAL_CRON_SETUP.md
  workflow_dispatch:  # Triggered by external cron (API) or manual "Run workflow"

jobs:
  run-challenge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: main  # Explicitly specify main branch
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install playwright
          playwright install chromium
      
      - name: Run daily challenge
        env:
          GEOGUESSR_COOKIE: ${{ secrets.GEOGUESSR_COOKIE }}
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
          GIST_ID: ${{ secrets.GIST_ID }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          python daily_softhouse_challenge.py
