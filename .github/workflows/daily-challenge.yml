name: Daily GeoGuessr Challenge

on:
  schedule:
    # Run hourly from 8:00 to 15:00 CET on weekdays (Mon-Fri)
    # CET is UTC+1 (winter) or UTC+2 (summer/CEST)
    # Using UTC+1 schedule (7:00-14:00 UTC) = 8:00-15:00 CET in winter
    # Note: In summer (CEST), this will run 1 hour earlier (7:00-14:00 CEST)
    # TEST: Running every 5 minutes to verify GitHub recognizes the schedule
    # TODO: Change back to '0 7-14 * * 1-5' after confirming it works
    - cron: '*/5 * * * *'  # TEST: Every 5 minutes
    # - cron: '0 7-14 * * 1-5'  # Every hour from 7-14 UTC = 8-15 CET (winter), 7-14 CEST (summer)
  workflow_dispatch:  # Allow manual trigger from GitHub UI

jobs:
  run-challenge:
    runs-on: ubuntu-latest
    permissions:
      contents: read  # Read-only access to repository
      # Gist access is handled via GH_TOKEN secret (Personal Access Token with gist scope)
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install playwright
          playwright install chromium
      
      - name: Run daily challenge
        env:
          GEOGUESSR_COOKIE: ${{ secrets.GEOGUESSR_COOKIE }}
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
          GIST_ID: ${{ secrets.GIST_ID }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          python daily_softhouse_challenge.py
